{% extends "base.html" %}
{% block title %}Drift Report{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto" id="main-content">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-white">üìê Drift Report</h2>
        <a href="/api/v1/drift?format=markdown" target="_blank" class="text-sm text-gray-400 hover:text-white">Export ‚Üó</a>
    </div>

    <!-- Misalignment statements -->
    {% if report.misalignment_statements %}
    <div class="mb-6 space-y-2">
        {% for statement in report.misalignment_statements %}
        <div class="bg-yellow-900/20 border border-yellow-800/50 rounded-lg p-3 text-sm text-yellow-300">
            ‚ö†Ô∏è {{ statement }}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-green-900/20 border border-green-800/50 rounded-lg p-3 mb-6 text-sm text-green-300">
        ‚úì No significant misalignments. Priorities and effort are aligned.
    </div>
    {% endif %}

    <!-- Campaign drift table -->
    <div class="bg-gray-800 rounded-lg overflow-hidden">
        <table class="w-full text-sm">
            <thead>
                <tr class="border-b border-gray-700">
                    <th class="text-left p-3 text-gray-400 font-medium">Campaign</th>
                    <th class="text-right p-3 text-gray-400 font-medium">Expected</th>
                    <th class="text-right p-3 text-gray-400 font-medium">Actual</th>
                    <th class="text-right p-3 text-gray-400 font-medium">Drift</th>
                    <th class="text-center p-3 text-gray-400 font-medium">Trend</th>
                </tr>
            </thead>
            <tbody>
                {% for c in report.campaigns %}
                <tr class="border-b border-gray-700/50 {% if c.is_misaligned %}bg-yellow-900/10{% endif %}">
                    <td class="p-3">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full" style="background-color: {{ c.colour }}"></span>
                            <span class="text-white">{{ c.name }}</span>
                            <span class="text-gray-500 text-xs">#{{ c.priority_rank }}</span>
                        </div>
                    </td>
                    <td class="text-right p-3 text-gray-300">{{ (c.expected_share * 100) | round }}%</td>
                    <td class="text-right p-3 text-gray-300">{{ (c.actual_share * 100) | round }}%</td>
                    <td class="text-right p-3 font-medium {% if c.drift > 0.05 %}text-green-400{% elif c.drift < -0.05 %}text-red-400{% else %}text-gray-400{% endif %}">
                        {{ "%+.0f" | format(c.drift * 100) }}%
                    </td>
                    <td class="text-center p-3">
                        {% if c.trend == 'improving' %}
                        <span class="text-green-400">‚Üë</span>
                        {% elif c.trend == 'worsening' %}
                        <span class="text-red-400">‚Üì</span>
                        {% elif c.trend == 'stable' %}
                        <span class="text-gray-400">‚Üí</span>
                        {% else %}
                        <span class="text-gray-500">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <p class="text-xs text-gray-500 mt-3">Total blocks this week: {{ report.total_blocks_this_week }}</p>
</div>
{% endblock %}
