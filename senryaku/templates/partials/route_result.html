<div class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-content max-w-lg">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-white">What should I do?</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-white text-xl min-h-[44px] min-w-[44px] flex items-center justify-center">&times;</button>
        </div>

        {% if not show_result %}
        <!-- Energy selector -->
        <p class="text-gray-400 text-sm mb-4">How's your energy right now?</p>
        <div class="grid grid-cols-3 gap-3 mb-4">
            <button hx-get="/partials/route-result?energy=green" hx-target="#modal-container"
                    class="bg-gray-800 hover:bg-green-900/50 rounded-xl p-4 text-center transition-all min-h-[72px]">
                <div class="text-2xl mb-1">ðŸŸ¢</div>
                <div class="text-sm text-gray-300">Good</div>
            </button>
            <button hx-get="/partials/route-result?energy=yellow" hx-target="#modal-container"
                    class="bg-gray-800 hover:bg-yellow-900/50 rounded-xl p-4 text-center transition-all min-h-[72px]">
                <div class="text-2xl mb-1">ðŸŸ¡</div>
                <div class="text-sm text-gray-300">Medium</div>
            </button>
            <button hx-get="/partials/route-result?energy=red" hx-target="#modal-container"
                    class="bg-gray-800 hover:bg-red-900/50 rounded-xl p-4 text-center transition-all min-h-[72px]">
                <div class="text-2xl mb-1">ðŸ”´</div>
                <div class="text-sm text-gray-300">Low</div>
            </button>
        </div>
        {% elif sortie %}
        <!-- Result: recommended sortie -->
        <div class="campaign-accent bg-gray-800 rounded-lg p-4 mb-4" style="--campaign-colour: {{ sortie.campaign_colour }}">
            <div class="flex items-center gap-2 mb-2">
                <span class="text-xs px-2 py-0.5 rounded-full font-medium
                    {% if sortie.cognitive_load.value == 'deep' %}badge-deep
                    {% elif sortie.cognitive_load.value == 'medium' %}badge-medium
                    {% else %}badge-light{% endif %}">
                    {% if sortie.cognitive_load.value == 'deep' %}ðŸ§ {% elif sortie.cognitive_load.value == 'medium' %}âš¡{% else %}ðŸŒ¿{% endif %}
                    {{ sortie.cognitive_load.value | title }}
                </span>
                <span class="text-xs text-gray-500">{{ sortie.campaign_name }} â†’ {{ sortie.mission_name }}</span>
            </div>
            <h4 class="text-lg font-semibold text-white mb-3">{{ sortie.title }}</h4>
            <a href="/sorties/{{ sortie.id }}/focus" onclick="closeModal()"
               class="inline-block px-4 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium min-h-[48px]">
                Start This Sortie â†’
            </a>
        </div>
        {% else %}
        <!-- No sortie available -->
        <div class="text-center py-6">
            <p class="text-gray-400 mb-2">Nothing queued that matches your energy.</p>
            <a href="/dashboard" onclick="closeModal()" class="text-indigo-400 hover:text-indigo-300 text-sm">Go to dashboard â†’</a>
        </div>
        {% endif %}
    </div>
</div>
