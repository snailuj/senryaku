{% extends "base.html" %}

{% block title %}{{ sortie.title }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto text-center" id="main-content">
    <!-- Campaign + Mission context (subtle) -->
    <div class="mb-2">
        <span class="text-sm text-gray-500">{{ campaign.name }} → {{ mission.name }}</span>
    </div>

    <!-- Sortie title -->
    <h1 class="text-3xl font-bold text-white mb-4">{{ sortie.title }}</h1>

    {% if sortie.description %}
    <p class="text-gray-400 mb-6 max-w-lg mx-auto">{{ sortie.description }}</p>
    {% endif %}

    <!-- Cognitive load badge -->
    <div class="mb-8">
        <span class="inline-block text-sm px-3 py-1 rounded-full font-medium
            {% if sortie.cognitive_load.value == 'deep' %}badge-deep
            {% elif sortie.cognitive_load.value == 'medium' %}badge-medium
            {% else %}badge-light{% endif %}">
            {% if sortie.cognitive_load.value == 'deep' %}Deep Focus{% elif sortie.cognitive_load.value == 'medium' %}Medium Focus{% else %}Light Work{% endif %}
        </span>
    </div>

    <!-- Timer -->
    <div class="mb-8">
        <div id="timer-display" class="text-7xl font-mono font-bold text-white mb-2 tabular-nums">90:00</div>
        <p class="text-sm text-gray-500">90-minute session</p>
    </div>

    <!-- Break reminder area -->
    <div id="break-reminder" class="hidden mb-6">
        <div class="inline-block bg-indigo-900/50 text-indigo-300 px-4 py-2 rounded-lg text-sm">
            Time for a micro-break — stretch, breathe, refocus
        </div>
    </div>

    <!-- Actions -->
    <div class="flex items-center justify-center gap-4">
        <button hx-get="/partials/aar-form?sortie_id={{ sortie.id }}"
                hx-target="#main-content"
                hx-swap="innerHTML"
                class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-medium rounded-lg transition-colors">
            Complete
        </button>
        <button hx-put="/api/v1/sorties/{{ sortie.id }}"
                hx-headers='{"X-API-Key": "{{ api_key }}"}'
                hx-vals='{"status": "abandoned"}'
                hx-target="#main-content"
                hx-swap="innerHTML"
                onclick="if(!confirm('Abandon this sortie?'))event.preventDefault()"
                class="px-4 py-3 text-gray-400 hover:text-red-400 text-sm transition-colors">
            Abandon
        </button>
    </div>
</div>

<script>
    // Start the 90-minute timer automatically
    document.addEventListener('DOMContentLoaded', function() {
        startTimer(90);
    });
</script>
{% endblock %}
